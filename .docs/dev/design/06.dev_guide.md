# Hướng dẫn phát triển - AI Parking

Tài liệu này cung cấp hướng dẫn chi tiết về cài đặt môi trường, cấu hình dự án, và các công cụ phát triển cho dự án AI Parking.

## 1. Tổng quan dự án

AI Parking là ứng dụng quản lý bãi đỗ xe thông minh sử dụng trí tuệ nhân tạo. Dự án gồm hai phần chính:

- **Frontend**: Ứng dụng di động phát triển bằng Flutter
- **Backend**: API phát triển bằng FastAPI (Python)

## 2. Cài đặt môi trường phát triển

### 2.1. Yêu cầu hệ thống

- **Hệ điều hành**: Windows 10/11, macOS 10.15+, hoặc Linux (Ubuntu 20.04+ khuyến nghị)
- **RAM**: Tối thiểu 8GB, khuyến nghị 16GB
- **Bộ nhớ trống**: Tối thiểu 10GB
- **Kết nối Internet**: Yêu cầu cho việc tải công cụ và thư viện

### 2.2. Cài đặt công cụ phát triển chung

#### 2.2.1. Git

Git là công cụ quản lý phiên bản cần #### 9.2.2. Lỗi API

```bash
# Kiểm tra logs API
uvicorn app.main:app --reload --log-level debug

# Kiểm tra endpoint bằng curl
curl -v http://localhost:8000/api/health
```

## 10. FAQ

### 10.1. Câu hỏi chung

**Q: Làm thế nào để bắt đầu với dự án?**  
A: Clone repository, làm theo hướng dẫn cài đặt, và đọc tài liệu kiến trúc.

**Q: Tôi cần quyền truy cập vào những gì?**  
A: GitHub repository, trello/jira board, và các tài khoản dịch vụ (Firebase, Google Maps, v.v.).*Windows:**

```bash
# Tải và cài đặt từ https://git-scm.com/download/win
```

**macOS:**

```bash
# Sử dụng Homebrew
brew install git
```

**Linux:**

```bash
sudo apt update
sudo apt install git
```

#### 2.2.2. Visual Studio Code

VS Code là IDE khuyến nghị cho dự án.

**Tất cả các nền tảng:**

- Tải và cài đặt từ [https://code.visualstudio.com/](https://code.visualstudio.com/)

**Extensions khuyến nghị:**

- Flutter
- Dart
- Python
- Docker
- Git Graph
- GitLens
- REST Client

#### 2.2.3. Docker và Docker Compose

Docker được sử dụng để đảm bảo môi trường phát triển nhất quán.

**Windows/macOS:**

- Tải và cài đặt Docker Desktop từ [https://www.docker.com/products/docker-desktop](https://www.docker.com/products/docker-desktop)

**Linux:**

```bash
# Docker
sudo apt update
sudo apt install docker.io
sudo systemctl enable --now docker

# Docker Compose
sudo apt install docker-compose
```

### 2.3. Cài đặt môi trường Flutter (Frontend)

#### 2.3.1. Cài đặt Flutter SDK

**Windows:**

```bash
# 1. Tải Flutter SDK từ https://flutter.dev/docs/get-started/install/windows
# 2. Giải nén vào thư mục (ví dụ: C:\flutter)
# 3. Thêm C:\flutter\bin vào PATH

# Kiểm tra cài đặt
flutter doctor
```

**macOS:**

```bash
# Sử dụng Homebrew
brew install --cask flutter

# Kiểm tra cài đặt
flutter doctor
```

**Linux:**

```bash
# 1. Tải Flutter SDK
cd ~/
git clone https://github.com/flutter/flutter.git -b stable

# 2. Thêm vào PATH
echo 'export PATH="$PATH:$HOME/flutter/bin"' >> ~/.bashrc
source ~/.bashrc

# Kiểm tra cài đặt
flutter doctor
```

#### 2.3.2. Cài đặt Android Studio

Android Studio cần thiết cho phát triển ứng dụng Android.

**Tất cả các nền tảng:**

- Tải và cài đặt từ [https://developer.android.com/studio](https://developer.android.com/studio)
- Mở và cài đặt Android SDK thông qua SDK Manager
- Tạo Android Virtual Device (AVD) để chạy ứng dụng

#### 2.3.3. Cài đặt Xcode (chỉ dành cho macOS)

Xcode cần thiết cho phát triển ứng dụng iOS.

```bash
# Cài đặt từ App Store hoặc sử dụng lệnh
xcode-select --install
```

### 2.4. Cài đặt môi trường Python (Backend)

#### 2.4.1. Cài đặt Python

Cài đặt Python 3.9+ và pip.

**Windows:**

- Tải và cài đặt từ [https://www.python.org/downloads/](https://www.python.org/downloads/)

**macOS:**

```bash
brew install python
```

**Linux:**

```bash
sudo apt update
sudo apt install python3 python3-pip python3-venv
```

#### 2.4.2. Cài đặt công cụ Python

```bash
# Cài đặt virtualenv
pip install virtualenv

# Cài đặt Poetry (quản lý dependency)
curl -sSL https://install.python-poetry.org | python3 -
```

#### 2.4.3. Cài đặt công cụ AI/ML

```bash
# Cài đặt các thư viện cơ bản
pip install numpy pandas matplotlib scikit-learn

# Cài đặt TensorFlow hoặc PyTorch (tùy theo nhu cầu)
pip install tensorflow
# HOẶC
pip install torch torchvision
```

### 2.5. Cài đặt cơ sở dữ liệu

#### 2.5.1. PostgreSQL

```bash
# Sử dụng Docker (khuyến nghị)
docker run --name ai-parking-postgres -e POSTGRES_PASSWORD=your_password -p 5432:5432 -d postgres:14

# Cài đặt trực tiếp trên Linux
sudo apt update
sudo apt install postgresql postgresql-contrib
```

#### 2.5.2. Redis

```bash
# Sử dụng Docker (khuyến nghị)
docker run --name ai-parking-redis -p 6379:6379 -d redis

# Cài đặt trực tiếp trên Linux
sudo apt update
sudo apt install redis-server
```

#### 2.5.3. MongoDB

```bash
# Sử dụng Docker (khuyến nghị)
docker run --name ai-parking-mongo -p 27017:27017 -d mongo

# Cài đặt trực tiếp trên Linux
sudo apt update
sudo apt install mongodb
```

## 3. Cấu hình dự án

### 3.1. Clone dự án

```bash
# Clone repository
git clone https://github.com/your-organization/ai-parking.git
cd ai-parking
```

### 3.2. Cấu hình Frontend (Flutter)

```bash
# Di chuyển đến thư mục Flutter
cd frontend

# Cài đặt dependencies
flutter pub get

# Chạy kiểm tra thiết bị
flutter devices

# Chạy ứng dụng trên thiết bị/emulator
flutter run
```

#### 3.2.1. Cấu trúc thư mục Frontend

```text
frontend/
├── android/            # Native Android code
├── ios/                # Native iOS code
├── lib/                # Dart code
│   ├── api/            # API services
│   ├── blocs/          # BLoC components
│   ├── models/         # Data models
│   ├── screens/        # UI screens
│   ├── utils/          # Utility functions
│   ├── widgets/        # Reusable widgets
│   └── main.dart       # Entry point
├── assets/             # Static assets
├── test/               # Unit and widget tests
└── pubspec.yaml        # Flutter dependencies
```

#### 3.2.2. Quy ước code Frontend

- **Đặt tên tệp**: snake_case (vd: home_screen.dart)
- **Đặt tên lớp**: PascalCase (vd: HomeScreen)
- **Đặt tên biến/hàm**: camelCase (vd: getUserProfile())
- **Thụt lề**: 2 khoảng trắng
- **Imports**: Sắp xếp theo Dart, Flutter, gói bên thứ ba, rồi đến các tệp cục bộ

### 3.3. Cấu hình Backend (FastAPI)

```bash
# Di chuyển đến thư mục Backend
cd backend

# Tạo môi trường ảo
python -m venv venv

# Kích hoạt môi trường ảo
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# Cài đặt dependencies
pip install -r requirements.txt

# Nếu sử dụng Poetry
poetry install

# Chạy ứng dụng
uvicorn app.main:app --reload
```

#### 3.3.1. Cấu trúc thư mục Backend

```text
backend/
├── app/
│   ├── api/            # API routes
│   │   └── endpoints/  # API endpoint modules
│   ├── core/           # Core modules
│   │   ├── config.py   # Configuration
│   │   └── security.py # Security utilities
│   ├── db/             # Database
│   │   ├── base.py     # Base classes
│   │   └── session.py  # DB session
│   ├── models/         # SQLAlchemy models
│   ├── schemas/        # Pydantic schemas
│   ├── services/       # Business logic
│   ├── utils/          # Utility functions
│   ├── ai/             # AI/ML modules
│   │   ├── models/     # AI models
│   │   └── training/   # Training scripts
│   └── main.py         # Entry point
├── migrations/         # Alembic migrations
├── tests/              # Unit and integration tests
├── alembic.ini         # Alembic config
├── pyproject.toml      # Poetry config
└── requirements.txt    # Dependencies
```

#### 3.3.2. Quy ước code Backend

- **Đặt tên tệp**: snake_case (vd: user_service.py)
- **Đặt tên lớp**: PascalCase (vd: UserService)
- **Đặt tên biến/hàm**: snake_case (vd: get_user_profile())
- **Thụt lề**: 4 khoảng trắng
- **Imports**: Sắp xếp theo thư viện chuẩn, gói bên thứ ba, rồi đến các mô-đun cục bộ

### 3.4. Cấu hình cơ sở dữ liệu

#### 3.4.1. Cấu hình PostgreSQL

```bash
# Tạo cơ sở dữ liệu
docker exec -it ai-parking-postgres psql -U postgres -c "CREATE DATABASE ai_parking;"

# Tạo người dùng
docker exec -it ai-parking-postgres psql -U postgres -c "CREATE USER ai_parking_user WITH PASSWORD 'your_password';"

# Cấp quyền
docker exec -it ai-parking-postgres psql -U postgres -c "GRANT ALL PRIVILEGES ON DATABASE ai_parking TO ai_parking_user;"
```

#### 3.4.2. Cấu hình Redis

Redis thường không yêu cầu cấu hình thêm cho phát triển.

#### 3.4.3. Cấu hình MongoDB

```bash
# Tạo cơ sở dữ liệu và người dùng
docker exec -it ai-parking-mongo mongosh --eval "db = db.getSiblingDB('ai_parking'); db.createUser({user: 'ai_parking_user', pwd: 'your_password', roles: [{role: 'readWrite', db: 'ai_parking'}]});"
```

### 3.5. Cấu hình biến môi trường

#### 3.5.1. Frontend

Tạo tệp `.env` trong thư mục `frontend`:

```env
API_BASE_URL=http://localhost:8000
GOOGLE_MAPS_API_KEY=your_google_maps_api_key
```

#### 3.5.2. Backend

Tạo tệp `.env` trong thư mục `backend`:

```env
# Database
DATABASE_URL=postgresql://ai_parking_user:your_password@localhost:5432/ai_parking
REDIS_URL=redis://localhost:6379/0
MONGODB_URL=mongodb://ai_parking_user:your_password@localhost:27017/ai_parking

# Security
SECRET_KEY=your_secret_key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Services
GOOGLE_MAPS_API_KEY=your_google_maps_api_key
STRIPE_API_KEY=your_stripe_api_key
FCM_SERVER_KEY=your_fcm_server_key

# AI
AI_MODEL_PATH=./app/ai/models
```

## 4. Quy trình phát triển

### 4.1. Quy trình Git

#### 4.1.1. Nhánh Git

- **main**: Nhánh chính, sẵn sàng triển khai sản xuất
- **develop**: Nhánh phát triển chính
- **feature/**: Nhánh tính năng (vd: feature/user-authentication)
- **bugfix/**: Nhánh sửa lỗi (vd: bugfix/login-crash)
- **release/**: Nhánh phát hành (vd: release/v1.0.0)
- **hotfix/**: Nhánh sửa lỗi khẩn cấp (vd: hotfix/critical-security-issue)

#### 4.1.2. Quy trình làm việc

1. Tạo nhánh tính năng từ `develop`

   ```bash
   git checkout develop
   git pull
   git checkout -b feature/my-feature
   ```

2. Phát triển và commit thay đổi

   ```bash
   git add .
   git commit -m "feat: add user authentication"
   ```

3. Đẩy nhánh lên remote

   ```bash
   git push -u origin feature/my-feature
   ```

4. Tạo Pull Request vào nhánh `develop`

5. Sau khi review, merge vào `develop`

6. Định kỳ, merge `develop` vào `main` qua nhánh `release`

#### 4.1.3. Quy ước commit

Sử dụng Conventional Commits:

```text
- **feat**: Tính năng mới
- **fix**: Sửa lỗi
- **docs**: Thay đổi tài liệu
- **style**: Thay đổi không ảnh hưởng đến code (khoảng trắng, định dạng, etc.)
- **refactor**: Tái cấu trúc code
- **test**: Thêm hoặc sửa đổi kiểm thử
- **chore**: Thay đổi công cụ xây dựng, thư viện, etc.
```

Ví dụ:

```bash
feat(auth): add NFC authentication
fix(ui): correct position of login button
docs: update API documentation
```

### 4.2. Kiểm thử

#### 4.2.1. Frontend Testing

```bash
# Chạy tất cả các kiểm thử
flutter test

# Chạy một tệp kiểm thử cụ thể
flutter test test/widget_test.dart

# Chạy với coverage
flutter test --coverage
```

#### 4.2.2. Backend Testing

```bash
# Chạy tất cả các kiểm thử
pytest

# Chạy một tệp kiểm thử cụ thể
pytest tests/api/test_user_api.py

# Chạy với coverage
pytest --cov=app tests/
```

### 4.3. CI/CD

Dự án sử dụng GitHub Actions cho CI/CD:

- **Kiểm thử**: Tự động chạy khi có PR vào `develop` hoặc `main`
- **Build**: Tự động build khi có merge vào `develop` hoặc `main`
- **Deploy**: Tự động triển khai khi có tag mới (vd: v1.0.0)

### 4.4. Code Review

- Mỗi PR phải có ít nhất 1 người review và approve
- Kiểm tra code style, lỗi tiềm ẩn, và kiểm thử
- Đảm bảo các tiêu chuẩn chất lượng code
- Sử dụng công cụ linting tự động (Flutter Analyze, Flake8)

## 5. Kiến trúc và quy tắc thiết kế

### 5.1. Kiến trúc Frontend

#### 5.1.1. Clean Architecture

Frontend áp dụng Clean Architecture với 4 layer:

1. **Presentation Layer**: UI, Widgets, Screens
2. **Business Logic Layer**: BLoCs, Cubits
3. **Domain Layer**: Use Cases, Entities, Repository Interfaces
4. **Data Layer**: Repositories, Data Sources, Models

#### 5.1.2. State Management

Sử dụng BLoC Pattern (Business Logic Component) để quản lý trạng thái:

```dart
// Event
abstract class AuthEvent {}
class LoginEvent extends AuthEvent {
  final String email;
  final String password;
  
  LoginEvent({required this.email, required this.password});
}

// State
abstract class AuthState {}
class AuthInitial extends AuthState {}
class AuthLoading extends AuthState {}
class AuthSuccess extends AuthState {}
class AuthFailure extends AuthState {
  final String message;
  
  AuthFailure({required this.message});
}

// BLoC
class AuthBloc extends Bloc<AuthEvent, AuthState> {
  final AuthRepository authRepository;
  
  AuthBloc({required this.authRepository}) : super(AuthInitial()) {
    on<LoginEvent>(_onLoginEvent);
  }
  
  Future<void> _onLoginEvent(LoginEvent event, Emitter<AuthState> emit) async {
    emit(AuthLoading());
    try {
      await authRepository.login(event.email, event.password);
      emit(AuthSuccess());
    } catch (e) {
      emit(AuthFailure(message: e.toString()));
    }
  }
}
```

### 5.2. Kiến trúc Backend

#### 5.2.1. Layered Architecture

Backend áp dụng Layered Architecture:

1. **API Layer**: Route Handlers, Request/Response Models
2. **Service Layer**: Business Logic
3. **Repository Layer**: Data Access
4. **Model Layer**: Data Models, Database Schema

#### 5.2.2. Dependency Injection

Sử dụng Dependency Injection để quản lý dependencies:

```python
# Dependency Injection Container
class Container:
    def __init__(self):
        self._services = {}
    
    def register(self, service_class, implementation):
        self._services[service_class] = implementation
    
    def resolve(self, service_class):
        return self._services.get(service_class)

# Sử dụng
container = Container()
container.register(IUserRepository, UserRepository)
container.register(IAuthService, AuthService)

# Trong endpoint
auth_service = container.resolve(IAuthService)
```

### 5.3. API Design

#### 5.3.1. RESTful Principles

- Sử dụng HTTP verbs (GET, POST, PUT, DELETE)
- Endpoint theo tài nguyên (vd: /api/users, /api/parking-lots)
- Trả về mã trạng thái HTTP phù hợp
- Sử dụng query parameters cho filtering, sorting, pagination

#### 5.3.2. API Documentation

Sử dụng Swagger/OpenAPI để tài liệu hóa API:

```python
@app.get("/api/users/{user_id}", response_model=UserResponse)
def get_user(user_id: UUID):
    """
    Get user by ID.
    
    Parameters:
    - user_id: UUID of the user
    
    Returns:
    - UserResponse: User information
    """
    # Implementation
```

## 6. Triển khai

### 6.1. Docker Compose

File `docker-compose.yml` cho triển khai local:

```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://ai_parking_user:your_password@db:5432/ai_parking
      - REDIS_URL=redis://redis:6379/0
      - MONGODB_URL=mongodb://ai_parking_user:your_password@mongo:27017/ai_parking
    depends_on:
      - db
      - redis
      - mongo
  
  db:
    image: postgres:14
    environment:
      - POSTGRES_USER=ai_parking_user
      - POSTGRES_PASSWORD=your_password
      - POSTGRES_DB=ai_parking
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  redis:
    image: redis:6
    volumes:
      - redis_data:/data
  
  mongo:
    image: mongo:5
    environment:
      - MONGO_INITDB_ROOT_USERNAME=ai_parking_user
      - MONGO_INITDB_ROOT_PASSWORD=your_password
    volumes:
      - mongo_data:/data/db

volumes:
  postgres_data:
  redis_data:
  mongo_data:
```

### 6.2. Các môi trường triển khai

#### 6.2.1. Development

- Local environment cho phát triển
- Sử dụng docker-compose local
- Database với dữ liệu mẫu

#### 6.2.2. Staging

- Môi trường gần giống production
- Triển khai trên cloud (AWS, GCP, Azure)
- CI/CD tự động triển khai từ nhánh `develop`

#### 6.2.3. Production

- Môi trường sản xuất
- Triển khai trên cloud với high availability
- CI/CD tự động triển khai từ nhánh `main`
- Monitoring và alerting

### 6.3. Sao lưu và khôi phục

- Database tự động sao lưu hàng ngày
- Lưu trữ sao lưu trong 30 ngày
- Kiểm tra khôi phục hàng tuần

## 7. Quản lý dự án

### 7.1. Issue Tracking

Sử dụng GitHub Issues hoặc Jira để theo dõi công việc:

- **Epic**: Tính năng lớn, có thể kéo dài nhiều sprint
- **Story**: Tính năng nhỏ, có thể hoàn thành trong một sprint
- **Task**: Công việc cụ thể, thường là một phần của Story
- **Bug**: Lỗi cần sửa

### 7.2. Agile Development

Dự án theo quy trình Agile:

- **Sprint**: 2 tuần
- **Daily Standup**: 15 phút mỗi ngày
- **Sprint Planning**: Đầu mỗi sprint
- **Sprint Review**: Cuối mỗi sprint
- **Sprint Retrospective**: Sau Sprint Review

### 7.3. Documentation

- **README.md**: Hướng dẫn tổng quan
- **CONTRIBUTING.md**: Hướng dẫn đóng góp
- **docs/**: Tài liệu chi tiết về kiến trúc, API, v.v.
- **Inline comments**: Comments trong code

## 8. Resources

### 8.1. Flutter Resources

- [Flutter Documentation](https://flutter.dev/docs)
- [Flutter Pub Packages](https://pub.dev/)
- [Flutter Community](https://flutter.dev/community)

### 8.2. FastAPI Resources

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [SQLAlchemy Documentation](https://docs.sqlalchemy.org/)
- [Python Packaging Guide](https://packaging.python.org/)

### 8.3. AI/ML Resources

- [TensorFlow Documentation](https://www.tensorflow.org/api_docs)
- [PyTorch Documentation](https://pytorch.org/docs/)
- [OpenCV Documentation](https://docs.opencv.org/)

### 8.4. Tools

- [Git Documentation](https://git-scm.com/doc)
- [Docker Documentation](https://docs.docker.com/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)

## 9. Xử lý sự cố

### 9.1. Flutter

#### 9.1.1. Lỗi build

```bash
# Làm sạch dự án
flutter clean
flutter pub get

# Kiểm tra phiên bản Flutter
flutter --version

# Cập nhật Flutter
flutter upgrade
```

#### 9.1.2. Lỗi hot reload

```bash
# Khởi động lại ứng dụng
flutter run

# Kiểm tra kết nối thiết bị
flutter devices
```

### 9.2. Backend

#### 9.2.1. Lỗi database connection

```bash
# Kiểm tra database connection
python -c "import psycopg2; conn = psycopg2.connect('postgresql://ai_parking_user:your_password@localhost:5432/ai_parking'); print('Connected!')"

# Kiểm tra logs
docker logs ai-parking-postgres
```#### 9.2.2. Lỗi API

```bash
# Kiểm tra logs API
uvicorn app.main:app --reload --log-level debug

# Kiểm tra endpoint bằng curl
curl -v http://localhost:8000/api/health
```

## 10. FAQ for AI Parking

### 10.1. Câu hỏi chung dự án

**Q: Làm thế nào để bắt đầu với dự án?**  
A: Clone repository, làm theo hướng dẫn cài đặt, và đọc tài liệu kiến trúc.

**Q: Tôi cần quyền truy cập vào những gì?**  
A: GitHub repository, trello/jira board, và các tài khoản dịch vụ (Firebase, Google Maps, v.v.).

### 10.2. Câu hỏi Frontend

**Q: Làm thế nào để thêm tính năng mới vào ứng dụng Flutter?**  
A: Tạo nhánh feature mới, phát triển theo Clean Architecture, viết tests, và tạo PR.

**Q: Làm thế nào để xử lý state management?**  
A: Sử dụng BLoC pattern cho state management. Xem tài liệu và mã hiện có.

### 10.3. Câu hỏi Backend

**Q: Làm thế nào để thêm endpoint API mới?**  
A: Tạo route mới trong module endpoints, thêm service logic, và cập nhật schema.

**Q: Làm thế nào để chạy migrations?**  
A: Sử dụng Alembic: `alembic upgrade head` để cập nhật DB, `alembic revision --autogenerate` để tạo migration mới.

## Kết luận

Tài liệu này cung cấp hướng dẫn toàn diện để thiết lập môi trường phát triển và bắt đầu làm việc với dự án AI Parking. Đảm bảo tuân thủ các quy ước và quy trình để duy trì chất lượng code và sự nhất quán trong dự án.

---
*Cập nhật: Đã bổ sung hướng dẫn cho các tính năng mới: cấu hình NFC, thiết lập mô hình AI offline, quản lý đồng bộ hóa dữ liệu, quản lý license.*
