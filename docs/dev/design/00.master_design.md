# Thiết kế tổng thể - AI Parking

Tài liệu này mô tả thiết kế tổng thể của hệ thống AI Parking, bao gồm luồng ứng dụng, kiến trúc hệ thống, mô hình dữ liệu và các thành phần chính.

## 1. Tổng quan hệ thống

AI Parking là một ứng dụng quản lý bãi đỗ xe thông minh sử dụng trí tuệ nhân tạo (AI) để tối ưu hóa việc quản lý, vận hành và sử dụng bãi đỗ xe. Hệ thống bao gồm các thành phần chính sau:

- **Ứng dụng di động** (Flutter): Dành cho người dùng cuối, chủ bãi đỗ xe, quản lý và nhân viên trực bãi.
- **Backend API** (FastAPI): Xử lý các yêu cầu từ ứng dụng, quản lý dữ liệu và cung cấp các dịch vụ AI.
- **Hệ thống AI**: Xử lý nhận diện biển số xe, dự báo nhu cầu đỗ xe, tối ưu hóa vận hành.
- **Cơ sở dữ liệu**: Lưu trữ thông tin về người dùng, bãi đỗ xe, lịch sử giao dịch và dữ liệu phân tích.
- **Hệ thống thanh toán**: Tích hợp các cổng thanh toán trực tuyến và ví điện tử.

## 2. Mô hình triển khai

```ascii
                      ┌─────────────────┐
                      │   Mobile App    │
                      │    (Flutter)    │
                      └────────┬────────┘
                               │
                               ▼
┌─────────────┐      ┌─────────────────┐      ┌─────────────┐
│  NFC Reader │◄────►│   Backend API   │◄────►│  Database   │
└─────────────┘      │    (FastAPI)    │      └─────────────┘
                     └────────┬────────┘
┌─────────────┐              │            ┌─────────────────┐
│   Camera    │◄─────────────┼───────────►│ Payment Gateway │
└─────────────┘              │            └─────────────────┘
                             │
                      ┌──────┴───────┐
                      │  AI Services  │
                      └──────────────┘
```

## 3. Thành phần chính

### 3.1. Ứng dụng di động (Frontend)

- **Công nghệ**: Flutter (Dart)
- **Nền tảng hỗ trợ**: Android, iOS
- **Kiến trúc**: Clean Architecture + BLoC Pattern
- **Tính năng chính**:
  - Xác thực và quản lý người dùng
  - Tìm kiếm và đặt chỗ đỗ xe
  - Thanh toán trực tuyến
  - Quản lý bãi đỗ xe (cho chủ bãi)
  - Nhận diện biển số xe (tích hợp AI offline)
  - Quét thẻ NFC
  - Thống kê và báo cáo
  - Hoạt động offline với đồng bộ dữ liệu khi online

### 3.2. Backend API (Backend)

- **Công nghệ**: FastAPI (Python)
- **Kiến trúc**: Microservices
- **Dịch vụ chính**:
  - Authentication Service: Xác thực và phân quyền người dùng
  - Parking Management Service: Quản lý bãi đỗ xe, chỗ đỗ xe
  - Booking Service: Quản lý đặt chỗ và lịch sử đỗ xe
  - Payment Service: Xử lý thanh toán
  - AI Service: Xử lý nhận diện biển số, dự báo nhu cầu
  - Notification Service: Gửi thông báo đẩy
  - License Management Service: Quản lý license và gia hạn

### 3.3. Hệ thống AI

- **Công nghệ**: TensorFlow/PyTorch, OpenCV
- **Mô hình AI**:
  - License Plate Recognition (LPR): Nhận diện biển số xe
  - Demand Forecasting: Dự báo nhu cầu đỗ xe
  - Revenue Optimization: Tối ưu hóa doanh thu
  - Vehicle Classification: Phân loại phương tiện

### 3.4. Cơ sở dữ liệu

- **Chính**: PostgreSQL (dữ liệu cấu trúc)
- **Cache**: Redis (dữ liệu tạm thời, session)
- **Phân tích**: MongoDB (dữ liệu lịch sử, log)
- **Đồng bộ hóa**: SQLite (cơ sở dữ liệu local cho tính năng offline)

### 3.5. Hệ thống tích hợp

- **Bản đồ**: Google Maps API/Mapbox
- **Thanh toán**: Stripe, PayPal, Local Payment Gateways
- **Thông báo**: Firebase Cloud Messaging
- **Phân tích**: Google Analytics, Firebase Analytics
- **Giám sát**: Prometheus, Grafana
- **CI/CD**: GitHub Actions, Docker, Kubernetes

## 4. Luồng ứng dụng chính

### 4.1. Luồng đăng ký và đăng nhập

1. Người dùng tải và cài đặt ứng dụng
2. Đăng ký tài khoản (email/số điện thoại + mật khẩu)
3. Xác thực qua email/SMS
4. Đăng nhập và truy cập tính năng theo vai trò

### 4.2. Luồng đặt chỗ đỗ xe (người dùng)

1. Tìm kiếm bãi đỗ xe gần nhất
2. Xem thông tin chi tiết (vị trí, giá, đánh giá, số chỗ trống)
3. Đặt chỗ và chọn thời gian
4. Thanh toán (nếu cần)
5. Nhận xác nhận đặt chỗ
6. Nhận chỉ dẫn đến bãi đỗ

### 4.3. Luồng quản lý xe ra/vào (nhân viên)

1. Quét thẻ NFC hoặc chụp biển số xe khi xe vào
2. Hệ thống tự động nhận diện biển số (có thể hoạt động offline)
3. Ghi nhận thời gian vào và cập nhật trạng thái bãi đỗ
4. Khi xe ra, quét thẻ NFC hoặc chụp biển số xe
5. Hệ thống tính toán thời gian đỗ và chi phí
6. Người dùng thanh toán (nếu chưa thanh toán trước)
7. Cập nhật trạng thái bãi đỗ
8. Đồng bộ dữ liệu khi có kết nối mạng (nếu làm việc ở chế độ offline)

### 4.4. Luồng quản lý bãi đỗ (chủ bãi)

1. Thiết lập thông tin bãi đỗ (vị trí, số chỗ, giá, thời gian hoạt động)
2. Theo dõi tình trạng bãi đỗ theo thời gian thực
3. Quản lý nhân viên và phân quyền
4. Xem báo cáo và thống kê
5. Tùy chỉnh cài đặt (giá, khuyến mãi, chính sách)
6. Quản lý và gia hạn license

## 5. Các yêu cầu phi chức năng

### 5.1. Bảo mật

- Mã hóa dữ liệu người dùng và thông tin thanh toán
- Xác thực hai yếu tố cho tài khoản chủ bãi đỗ
- Kiểm soát truy cập dựa trên vai trò (RBAC)
- Quản lý token JWT an toàn

### 5.2. Hiệu suất

- Thời gian phản hồi API < 500ms
- Xử lý nhận diện biển số < 2 giây
- Hỗ trợ đồng thời 1000+ người dùng
- Thời gian khởi động ứng dụng < 3 giây

### 5.3. Khả năng mở rộng

- Kiến trúc microservices cho phép mở rộng theo chiều ngang
- Cân bằng tải tự động
- Database sharding cho dữ liệu lớn

### 5.4. Khả năng sẵn sàng

- Uptime > 99.9%
- Sao lưu dữ liệu hàng ngày
- Chiến lược khôi phục thảm họa

### 5.5. Khả năng hoạt động offline

- Lưu trữ dữ liệu cần thiết trên thiết bị
- Đồng bộ hóa tự động khi có kết nối
- Xử lý xung đột dữ liệu

## 6. Tích hợp với hệ thống bên ngoài

### 6.1. Tích hợp bản đồ

- Hiển thị bãi đỗ xe trên bản đồ
- Chỉ đường đến bãi đỗ
- Ước tính thời gian di chuyển

### 6.2. Tích hợp thanh toán

- Cổng thanh toán trực tuyến
- Ví điện tử
- Thanh toán qua thẻ NFC

### 6.3. Tích hợp camera

- Kết nối với camera RTSP
- Chụp ảnh biển số xe
- Lưu trữ hình ảnh an ninh

### 6.4. Tích hợp thiết bị NFC

- Đọc thẻ NFC
- Xác thực danh tính
- Ghi nhận thời gian vào/ra

## 7. Kết luận

Thiết kế tổng thể của AI Parking tập trung vào việc xây dựng một hệ thống toàn diện, mạnh mẽ và linh hoạt, có khả năng đáp ứng các yêu cầu của nhiều đối tượng người dùng khác nhau. Kiến trúc microservices và mô hình dữ liệu được thiết kế để hỗ trợ các tính năng hiện tại và dễ dàng mở rộng trong tương lai.

---
*Cập nhật: Đã bổ sung các tính năng mới về quét thẻ NFC, nhận diện biển số xe tự động bằng AI offline, hỗ trợ cập nhật trạng thái bãi đỗ khi thiết bị online trở lại, quản lý license và thông báo gia hạn.*
